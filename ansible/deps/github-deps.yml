---
- name: Download latest GitHub release binaries with gh CLI
  hosts: 127.0.0.1
  gather_facts: no
  vars:
    github_repos:
      - repo: "openai/codex"
        binary_name: "codex"
        asset_pattern: "codex-x86_64-unknown-linux-musl.tar.gz"
      - repo: "thanos-io/thanos"
        binary_name: "thanos"
        asset_pattern: "*linux-amd64*"
      - repo: "tobi/try-cli"
        binary_name: "try"
        asset_pattern: "*x86_64*"
      - repo: pranshuparmar/witr
        binary_name: "witr"
        asset_pattern: "witr-linux-amd64"
      - repo: "lance0/ttl"
        binary_name: "ttl"
        asset_pattern: "ttl-x86_64-unknown-linux-musl.tar.gz"

    download_dir: "~/.local/bin"
    tmp_dir: "/tmp/github_downloads"

  tasks:
    - name: Ensure temporary directory exists
      file:
        path: "{{ tmp_dir }}"
        state: directory

    - name: Install from GitHub releases
      include_tasks: github-repo.yml
      loop: "{{ github_repos }}"
      loop_control:
        loop_var: repo_info
        label: "{{ repo_info.repo }}"
      vars:
        repo: "{{ repo_info.repo }}"
        binary_name: "{{ repo_info.binary_name }}"
        asset_pattern: "{{ repo_info.asset_pattern }}"
